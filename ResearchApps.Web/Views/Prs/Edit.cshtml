@model ResearchApps.Service.Vm.PrVm

@{
    ViewBag.Title = "Edit Purchase Requisition";
    ViewBag.pTitle = $"Edit Purchase Requisition No. {Model.PrId}";
    Layout = "_Layout";
}

<div x-data="prEditForm()" x-init="init()">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Edit Purchase Requisition - @Model.PrId</h5>
                </div>
                <div class="card-body">
                    <form id="pr-form" asp-action="Edit" method="post">
                        @Html.AntiForgeryToken()
                        
                        <!-- Validation Summary -->
                        <div id="validation-summary" x-show="Object.keys(errors).length > 0" x-cloak>
                            <div class="alert alert-danger">
                                <template x-for="(error, field) in errors" :key="field">
                                    <div x-text="error"></div>
                                </template>
                            </div>
                        </div>
                        
                        <input type="hidden" asp-for="PrId" />
                        <input type="hidden" asp-for="RecId" />
                        <input type="hidden" asp-for="CreatedDate" />
                        <input type="hidden" asp-for="CreatedBy" />
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="PrDate" class="form-label">PR Date <span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <input type="text" 
                                               id="PrDate" 
                                               name="PrDate"
                                               class="form-control" 
                                               value="@Model.PrDate.ToString("yyyy-MM-dd")"
                                               x-ref="prDatePicker"
                                               data-flatpickr
                                               :class="{ 'is-invalid': errors.PrDate }"
                                               required />
                                        <span class="input-group-text"><i class="ri-calendar-line"></i></span>
                                    </div>
                                    <div class="invalid-feedback" x-show="errors.PrDate" x-text="errors.PrDate"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="PrName" class="form-label">PR Name <span class="text-danger">*</span></label>
                                    <input type="text" 
                                           id="PrName" 
                                           name="PrName"
                                           class="form-control"
                                           value="@Model.PrName"
                                           :class="{ 'is-invalid': errors.PrName }"
                                           maxlength="200"
                                           required />
                                    <div class="invalid-feedback" x-show="errors.PrName" x-text="errors.PrName"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="BudgetId" class="form-label">Budget <span class="text-danger">*</span></label>
                                    <select id="BudgetId" 
                                            name="BudgetId" 
                                            class="form-control"
                                            x-ref="budgetSelect"
                                            data-tomselect
                                            data-url="/api/Budgets/cbo"
                                            :class="{ 'is-invalid': errors.BudgetId }"
                                            required>
                                        <option value="">Select Budget</option>
                                        <option value="@Model.BudgetId" selected>@Model.BudgetName</option>
                                    </select>
                                    <div class="invalid-feedback" x-show="errors.BudgetId" x-text="errors.BudgetId"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="Notes" class="form-label">Notes (Optional)</label>
                                    <textarea id="Notes" 
                                              name="Notes" 
                                              class="form-control" 
                                              rows="3"
                                              maxlength="500">@Model.Notes</textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button type="button" 
                                    class="btn btn-primary" 
                                    @@click="confirmUpdate()"
                                    :disabled="isSubmitting">
                                <span x-show="!isSubmitting">Save Changes</span>
                                <span x-show="isSubmitting" x-cloak>
                                    <span class="spinner-border spinner-border-sm me-1"></span> Saving...
                                </span>
                            </button>
                            <a href="/Prs/Details/@Model.RecId" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/js/purchase-requisitions/pr-edit.js"></script>
}
